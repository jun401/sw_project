<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“Š ì‹ë‹¨ ë¦¬í¬íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: linear-gradient(to bottom right, #f9fff7, #ffffff);
      margin: 0;
      padding: 40px;
      color: #333;
      text-align: center;
    }
    h1 { color: #2e7d32; font-size: 38px; margin-bottom: 10px; }
    .summary { margin-bottom: 25px; font-size: 18px; color: #555; }
    .chart-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 40px;
      justify-items: center;
      margin-top: 40px;
    }
    canvas {
      background: #fff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 420px;
      width: 100%;
      height: 320px;
    }
    .back {
      display: inline-block;
      margin-top: 40px;
      color: #388e3c;
      text-decoration: none;
      font-weight: bold;
    }
    .back:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <h1>ğŸ“Š ì´ë²ˆ ì£¼ ì‹ë‹¨ ë¦¬í¬íŠ¸</h1>

  <p class="summary">
    ğŸ¥— í‰ê·  ì¹¼ë¡œë¦¬:
    <strong th:text="${avgKcal} != null ? ${avgKcal} + ' kcal' : '0 kcal'">1750 kcal</strong>
    |
    ğŸ ì˜ì–‘ ë¹„ìœ¨:
    <strong th:text="'íƒ„ ' + (${carb}?:45) + '% / ë‹¨ ' + (${protein}?:35) + '% / ì§€ ' + (${fat}?:20) + '%'">
      íƒ„ 45% / ë‹¨ 35% / ì§€ 20%
    </strong>
  </p>

  <div class="chart-container">
    <!-- 1ï¸âƒ£ í•˜ë£¨ë³„ ì¹¼ë¡œë¦¬ -->
    <canvas id="calorieChart" aria-label="ì¼ë³„ ì¹¼ë¡œë¦¬ ê·¸ë˜í”„" role="img"></canvas>

    <!-- 2ï¸âƒ£ ì˜ì–‘ì†Œ ë¹„ìœ¨ -->
    <canvas id="nutrientChart" aria-label="íƒ„ë‹¨ì§€ ë¹„ìœ¨ ë„ë„›" role="img"></canvas>

    <!-- 3ï¸âƒ£ ì¬ë£Œ ì‚¬ìš© ë¹ˆë„ -->
    <canvas id="ingredientChart" aria-label="ì¬ë£Œ ì‚¬ìš© ë¹ˆë„ ë§‰ëŒ€" role="img"></canvas>
  </div>

  <a href="/main" class="back">â† ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>

  <!-- âœ… Thymeleaf JS ì¸ë¼ì¸: ê°’ì´ ì—†ì„ ë•Œë„ ì•ˆì „í•œ ê¸°ë³¸ê°’ ì œê³µ -->
  <script th:inline="javascript">
    // â”€â”€ ì„œë²„ì—ì„œ ë„˜ì–´ì˜¨ ê°’ë“¤ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒ€ì²´) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const avgKcal = /*[[${avgKcal}?:0]]*/ 0;

    const carb    = /*[[${carb}?:45]]*/ 45;
    const protein = /*[[${protein}?:35]]*/ 35;
    const fat     = /*[[${fat}?:20]]*/ 20;

    // List/Collectionì€ JS ë°°ì—´ë¡œ ì•ˆì „í•˜ê²Œ ë Œë”ë§ë¨(th:inline="javascript" í•„ìš”)
    const ingredientLabels = /*[[${ingredientLabels}?:[]]]*/ [];
    const ingredientData   = /*[[${ingredientData}?:[]]]*/ [];

    // â”€â”€ 1) ì¼ë³„ ì¹¼ë¡œë¦¬ ê·¸ë˜í”„ (ìƒ˜í”Œ/ë°ëª¨ ë°ì´í„°: DB ì—°ë™ ì „ìš©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const calorieCtx = document.getElementById("calorieChart");
    new Chart(calorieCtx, {
      type: "line",
      data: {
        labels: ["ì›”", "í™”", "ìˆ˜", "ëª©", "ê¸ˆ", "í† ", "ì¼"],
        datasets: [{
          label: "ì¼ì¼ ì„­ì·¨ ì¹¼ë¡œë¦¬",
          data: [1600, 1800, 1700, 1900, 1750, 2000, 1850],
          borderWidth: 2,
          borderColor: "#4caf50",
          backgroundColor: "rgba(76,175,80,0.18)",
          fill: true,
          tension: 0.3,
          pointRadius: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: true },
          title: { display: true, text: "ğŸ“… ì¼ë³„ ì¹¼ë¡œë¦¬ ë³€í™”" },
          tooltip: { enabled: true }
        },
        scales: {
          y: { beginAtZero: true }
        }
      }
    });

    // â”€â”€ 2) ì˜ì–‘ ë¹„ìœ¨ ë„ë„› ì°¨íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const nutrientCtx = document.getElementById("nutrientChart");
    new Chart(nutrientCtx, {
      type: "doughnut",
      data: {
        labels: ["íƒ„ìˆ˜í™”ë¬¼", "ë‹¨ë°±ì§ˆ", "ì§€ë°©"],
        datasets: [{
          data: [carb, protein, fat],
          backgroundColor: ["#66bb6a", "#42a5f5", "#ffb74d"],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: { display: true, text: "ğŸ íƒ„ë‹¨ì§€ ë¹„ìœ¨" },
          legend: { position: "bottom" },
          tooltip: { enabled: true }
        },
        cutout: "60%"
      }
    });

    // â”€â”€ 3) ì¬ë£Œ ì‚¬ìš© ë¹ˆë„ ë§‰ëŒ€ ì°¨íŠ¸ (ë°ì´í„° ì—†ìœ¼ë©´ ì•ˆë‚´ ë¬¸êµ¬ ì²˜ë¦¬) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const ingCtx = document.getElementById("ingredientChart");
    const labelsSafe = Array.isArray(ingredientLabels) ? ingredientLabels : [];
    const dataSafe   = Array.isArray(ingredientData) ? ingredientData : [];

    new Chart(ingCtx, {
      type: "bar",
      data: {
        labels: labelsSafe.length ? labelsSafe : ["ë°ì´í„° ì—†ìŒ"],
        datasets: [{
          label: "ì‚¬ìš© íšŸìˆ˜",
          data: dataSafe.length ? dataSafe : [0],
          backgroundColor: "#81c784",
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: { display: true, text: "ğŸ¥¦ ì¬ë£Œ ì‚¬ìš© ë¹ˆë„" },
          legend: { display: false },
          tooltip: { enabled: true }
        },
        scales: {
          x: { ticks: { color: "#333" } },
          y: { beginAtZero: true, ticks: { stepSize: 1 } }
        }
      }
    });
  </script>
</body>
</html>
